**Chrome 瀏覽器插件開發規範：AI 提示詞管理助手**

**1. 專案概述**

*   **插件名稱：** AI 提示詞管理助手
*   **插件目標：** 提供使用者一個方便、高效的方式來儲存、管理、搜尋、使用及分享 AI 提示詞 (Prompts)，提升使用者與 AI 互動的效率。
*   **目標使用者：** 經常使用大型語言模型或其他需要輸入提示詞之 AI 工具的使用者。
*   **核心價值：** 集中管理、快速取用、便捷分享、自訂分類。

**2. 插件核心功能**

*   **提示詞儲存：** 允許使用者儲存包含標題、用途描述、內容本文、以及分類標籤的提示詞。
*   **標籤管理：** 支援為提示詞添加 `#` 開頭的標籤，並能基於標籤進行篩選。
*   **提示詞編輯：** 提供修改已儲存提示詞所有欄位的功能。
*   **提示詞複製 (建立副本)：** 快速建立一個現有提示詞的副本，並自動修改標題。
*   **提示詞刪除與復原：** 提供軟刪除功能（移至垃圾桶）及從垃圾桶復原或永久刪除的功能。
*   **垃圾桶管理：** 集中管理已刪除的提示詞，支援單獨永久刪除或清空垃圾桶。
*   **提示詞搜尋：** 提供即時關鍵字搜尋功能，範圍涵蓋所有提示詞（包含垃圾桶內）。
*   **提示詞排序：** 支援多種排序條件（最近新增/修改、建立時間、修改時間）。
*   **快速取用：** 提供一鍵複製提示詞內容至剪貼簿，以及嘗試將提示詞內容插入目前頁面輸入框的功能。
*   **資料匯入/匯出：** 支援將單一、部分選取或全部提示詞以 JSON 格式匯出，以及從 JSON 檔案匯入提示詞。

**3. 使用者介面 (UI) 規劃**

*   **整體架構：** 採用 Chrome 瀏覽器側邊欄 (Side Panel) 形式展示。
*   **主要介面佈局：**
    *   **頂部：**
        *   **插件名稱：** 固定顯示於最上方。
        *   **搜尋欄 (Search Bar)：** 位於插件名稱下方，佔據主要寬度。
    *   **中部：**
        *   **頁籤列 (Tab Bar)：** 水平排列，位於搜尋欄下方。包含以下頁籤：
            *   `➕ 新增提示詞`
            *   `📖 提示詞` (預設顯示)
            *   `#️⃣ 標籤`
            *   `🗑️ 垃圾桶`
            *   `↔️ 匯入/匯出`
    *   **內容區域：** 位於頁籤列下方，根據當前選中的頁籤動態顯示對應內容。

**4. 詳細功能與互動邏輯**

**4.1. 通用元素與行為**

*   **側邊欄開啟/關閉：** 透過瀏覽器工具列的插件圖示控制側邊欄的顯示與隱藏，每次開啟插件時預設顯示「提示詞」頁籤。
*   **確認對話框：** 所有刪除、永久刪除、放棄修改、放棄新增等不可逆或可能導致資料遺失的操作，均需彈出確認對話框，提供「確認」與「取消」選項。對話框文字需清晰說明操作後果。

**4.2. 搜尋欄**

*   **位置：** 固定於插件名稱下方。
*   **行為：**
    *   當使用者在搜尋欄輸入文字時，內容區域**即時**顯示符合條件的提示詞列表。
    *   搜尋範圍應包含提示詞的**標題、用途、內容、標籤**。
    *   搜尋結果應包含**所有狀態**的提示詞（「提示詞」頁籤中的和「垃圾桶」頁籤中的），但需在視覺上區分來源或狀態（例如，垃圾桶中的提示詞可加上刪除線或標示）。
    *   搜尋結果列表的左上方應顯示「排序」按鈕。
*   **排序功能 (搜尋結果)：**
    *   點擊「排序」按鈕，彈出下拉選單。
    *   選項包含：「最近新增/修改」、「建立時間 (新至舊)」、「建立時間 (舊至新)」、「修改時間 (新至舊)」、「修改時間 (舊至新)」。
    *   選擇排序選項後，搜尋結果列表**立即**依照新條件重新排序。預設排序為「最近新增/修改」。
*   **搜尋結果條目互動：**
    *   **顯示：** 每條結果應清晰顯示提示詞標題，可考慮顯示部分內容或用途摘要。
    *   **操作按鈕 (每條右側或下方)：**
        *   `[複製]` (圖示): 點擊後，將該提示詞的**內容 (content)** 複製到系統剪貼簿，並提供短暫的成功提示 (例如：按鈕變色或顯示 "已複製！")。
        *   `[插入]` (圖示): **(需 Content Script 權限)** 點擊後，嘗試將該提示詞的**內容 (content)** 插入到當前瀏覽器頁面中具有焦點的輸入框或文本區域 (滑鼠游標所在處)。若無法偵測或插入，應提供適當提示。
        *   `[刪除]` (圖示): (僅對非垃圾桶中的提示詞有效) 點擊後，彈出**確認刪除**視窗。確認後，將該提示詞移至「垃圾桶」頁籤，並從目前搜尋結果或「提示詞」列表中移除。
        *   `[建立副本]` (圖示): (僅對非垃圾桶中的提示詞有效) 點擊後，立即在資料庫中建立一條新的提示詞記錄，其內容與原提示詞完全相同，但標題自動變更為 `[原標題] 的副本`。建立成功後，短暫將新副本高亮顯示2秒。
        *   `[匯出]` (圖示): (僅對非垃圾桶中的提示詞有效) 點擊後，觸發瀏覽器的檔案下載/儲存對話框，讓使用者選擇儲存路徑。匯出的檔案為 JSON 格式，僅包含該單一提示詞的資料。
    *   **點擊條目本身：** (僅對非垃圾桶中的提示詞有效) 點擊提示詞條目的任何非按鈕區域，應觸發**修改提示詞**介面 (詳見 4.4)。

**4.3. 新增提示詞頁籤 (`➕ 新增提示詞`)**

*   **觸發方式：** 點擊頁籤列的「新增提示詞」頁籤。
*   **介面呈現：** 內容區域顯示新增表單，或彈出一個模態視窗 (Modal)。包含以下欄位：
    *   **提示詞標題 (Title):** 文字輸入框。**必填**。需有明確標示。
    *   **提示詞用途 (Purpose):** 多行文字輸入框 (Textarea)。**選填**。
    *   **提示詞內容 (Content):** 主要的多行文字輸入框 (Textarea)。**必填**。需有明確標示。建議提供較大編輯空間。
    *   **提示詞分類標籤 (Tags):** 文字輸入框。**選填**。
        *   輸入時，應**自動**在輸入框下方顯示已存在標籤的建議列表 (下拉選單)，匹配使用者輸入的字元。
        *   使用者可點擊建議標籤快速選用。
        *   輸入規範：標籤文字前**必須**加上 `#` 號。若需輸入多個標籤，使用 `#` 作為分隔符 (例如：`#寫作#翻譯#摘要`)。儲存時應處理掉多餘空格，並將其拆分為獨立標籤陣列儲存。
*   **操作按鈕：**
    *   `[儲存]`：點擊後，進行欄位驗證 (標題、內容是否填寫)。驗證通過則儲存該提示詞至資料庫，清空表單或關閉模態視窗，並可選擇性跳轉至「提示詞」頁籤顯示最新加入的項目。
    *   `[放棄]`：點擊後，彈出**確認放棄**視窗。確認後，清空所有已輸入的內容，返回到點擊「新增」前的狀態或關閉模態視窗。

**4.4. 提示詞頁籤 (`📖 提示詞`)**

*   **介面呈現：** 內容區域條列顯示所有**未被刪除**的已儲存提示詞。
*   **排序功能：**
    *   列表左上方應顯示「排序」按鈕，功能與搜尋結果的排序功能完全相同 (選項、行為一致)。
    *   預設排序為「最近新增/修改」。
*   **提示詞條目互動：**
    *   **顯示：** 同 4.2 搜尋結果條目顯示。
    *   **操作按鈕 (每條右側或下方)：** 同 4.2 搜尋結果條目的 `[複製]`, `[插入]`, `[刪除]`, `[建立副本]`, `[匯出]` 按鈕，功能完全一致。
    *   **點擊條目本身：** 點擊提示詞條目的任何非按鈕區域，彈出或切換至**修改提示詞**介面。
*   **修改提示詞介面：**
    *   介面佈局與「新增提示詞」介面 (4.3) 非常相似，但需預先填入被點擊提示詞的現有資料 (標題、用途、內容、標籤)。
    *   **操作按鈕：**
        *   `[確認修改]`：點擊後，進行欄位驗證 (標題、內容不可為空)。驗證通過則使用新內容更新資料庫中對應的提示詞記錄，更新 `updatedAt` 時間戳，關閉修改介面，並在列表中顯示更新後的結果。
        *   `[放棄修改]`：點擊後，彈出**確認放棄修改**視窗。確認後，不儲存任何變更，關閉修改介面，返回列表視圖。

**4.5. 標籤頁籤 (`#️⃣ 標籤`)**

*   **介面呈現：**
    *   **頂部區域：** 以按鈕或標籤雲 (Tag Cloud) 的形式，顯示所有**已存在**且**至少被一個未刪除提示詞使用**的標籤列表。每個標籤應可點擊。
    *   **下方內容區域：** 預設顯示所有未刪除的提示詞 (同「提示詞」頁籤初始狀態)，或提示使用者「請點擊上方標籤進行篩選」。
*   **互動邏輯：**
    *   點擊頂部的某個標籤按鈕：
        *   該標籤按鈕呈現被選中狀態 (例如：高亮、不同背景色)。
        *   下方內容區域**立即**篩選並顯示所有**包含該標籤**的未刪除提示詞。
        *   篩選結果的列表樣式、排序功能、條目互動邏輯 (包含操作按鈕、點擊修改) 應與「提示詞」頁籤 (4.4) 完全一致。
    *   再次點擊已被選中的標籤，或提供一個「清除篩選/顯示全部」的按鈕/選項，可以取消篩選，下方列表恢復顯示所有提示詞。
    *   支援多標籤篩選：例如，按住 Ctrl/Cmd 點擊標籤可進行多選，下方顯示同時包含所有選中標籤的提示詞。

**4.6. 垃圾桶頁籤 (`🗑️ 垃圾桶`)**

*   **介面呈現：** 內容區域條列顯示所有**已被刪除** (isDeleted = true) 的提示詞。
*   **頂部操作按鈕：**
    *   `[選擇刪除]`：
        *   點擊後，進入「選擇模式」。此按鈕變為不可操作 (反灰)。
        *   每條已刪除提示詞前方出現**核取方塊 (Checkbox)**。
        *   頂部操作按鈕區域**新增** `[永久刪除選取項目]` 和 `[取消]` 按鈕。
        *   使用者勾選需要永久刪除的提示詞。
        *   點擊 `[永久刪除選取項目]`：彈出**確認永久刪除**視窗 (強調此操作不可逆)。確認後，將所有**被勾選**的提示詞從資料庫中**徹底移除**。移除後退出選擇模式，更新垃圾桶列表。
        *   點擊 `[取消]`：退出選擇模式，隱藏核取方塊和新增的按鈕，恢復 `[選擇刪除]` 按鈕為可操作狀態。
    *   `[清空垃圾桶]`：
        *   點擊後，彈出**確認清空垃圾桶**視窗 (強調此操作不可逆，將刪除所有垃圾桶內項目)。
        *   確認後，將所有**標記為已刪除**的提示詞從資料庫中**徹底移除**。移除後更新垃圾桶列表（應為空）。
*   **已刪除條目互動：**
    *   **顯示：** 清晰顯示提示詞標題，可考慮加上刪除線或其他視覺標示。
    *   **操作按鈕 (每條右側或下方)：**
        *   `[復原]` (圖示): 點擊後，將該提示詞的 `isDeleted` 狀態設為 `false`，並將其從垃圾桶列表中移除 (它將重新出現在「提示詞」和「標籤」頁籤中)。
        *   `[永久刪除]` (圖示): 點擊後，彈出**確認永久刪除**視窗 (強調此操作不可逆)。確認後，將該單一提示詞從資料庫中**徹底移除**。移除後更新垃圾桶列表。

**4.7. 匯入/匯出頁籤 (`↔️ 匯入/匯出`)**

*   **介面呈現：** 內容區域包含以下按鈕和可能的狀態提示。
    *   `[部分匯出]`
    *   `[全部匯出]`
    *   `[匯入]` (通常是一個 `<input type="file">` 元素包裝的按鈕)
*   **互動邏輯：**
    *   **[部分匯出]：**
        *   點擊後，進入「選擇匯出模式」。
        *   `[部分匯出]`, `[全部匯出]`, `[匯入]` 按鈕均變為**不可操作 (反灰)**。
        *   頁面下方（或在按鈕區域下方）**條列顯示所有未刪除的提示詞**，每條前方帶有**核取方塊 (Checkbox)**。
        *   頁面原按鈕位置旁**新增** `[匯出選取項目]` 和 `[取消]` 按鈕。
        *   使用者勾選需要匯出的提示詞。
        *   點擊 `[匯出選取項目]`：
            *   收集所有**被勾選**的提示詞資料。
            *   將這些資料格式化為 **JSON** 陣列。
            *   觸發瀏覽器的檔案下載/儲存對話框，讓使用者選擇儲存路徑和檔名 (預設檔名可為 `ai_prompts_export_[日期].json`)。
            *   匯出完成後，退出選擇匯出模式。
        *   點擊 `[取消]`：退出選擇匯出模式，隱藏列表和新增的按鈕，恢復初始按鈕狀態。
    *   **[全部匯出]：**
        *   點擊後，收集**所有未刪除**的提示詞資料。
        *   將這些資料格式化為 **JSON** 陣列。
        *   觸發瀏覽器的檔案下載/儲存對話框，同上。
    *   **[匯入]：**
        *   點擊後，觸發瀏覽器的檔案選擇對話框，限制使用者只能選擇 `.json` 檔案。
        *   使用者選擇檔案並確認後：
            *   插件讀取並解析 JSON 檔案內容。
            *   **驗證**檔案格式是否符合預期 (例如，是否為包含提示詞物件的陣列)。
            *   **處理重複：** 以標題為基礎判斷重複，並以建立副本行為來處理匯入資料與現有資料的衝突，例如將匯入的衝突項目重命名為`[原標題] 的副本`。
            *   將驗證通過且處理完衝突的提示詞資料**新增**到插件的資料庫中。
            *   匯入完成後，提供成功或失敗 (及原因) 的提示訊息。

**5. 資料結構與儲存**

*   **儲存方式：** 建議使用 `chrome.storage.local` API。此 API 提供非同步儲存，適合儲存結構化資料，且容量較 `chrome.storage.sync` 大。
*   **資料結構 (單一提示詞 Prompt Object):**

```json
{
  "id": "unique_identifier_string", // 唯一 ID (例如 UUID 或時間戳+隨機數)
  "title": "提示詞標題", // 字串, 必填
  "purpose": "提示詞用途描述", // 字串, 選填
  "content": "提示詞的完整內容", // 字串, 必填
  "tags": ["#標籤一", "#標籤二"], // 字串陣列, 選填, 儲存時確保 # 前綴
  "createdAt": "ISO8601_datetime_string", // 建立時間戳
  "updatedAt": "ISO8601_datetime_string", // 最後修改時間戳
  "isDeleted": false // 布林值, 標識是否在垃圾桶中
}
```

*   **整體儲存結構：** 可以在 `chrome.storage.local` 中儲存一個包含所有提示詞物件的陣列，例如：

```json
{
  "prompts": [
    {...promptObject1...},
    {...promptObject2...},
    // ... 其他提示詞
  ]
}
```

*   **索引與效能：** 隨著提示詞數量增長，需要考慮讀取和搜尋的效能。雖然 `chrome.storage.local` 沒有內建索引，但在讀取後於記憶體中處理或建立簡單索引（如標籤到 ID 的映射）可能有助於提高篩選速度。

**6. 匯入/匯出格式**

*   **格式：** JSON (JavaScript Object Notation)。
*   **結構：** 匯出的 JSON 檔案應包含一個名為 `prompts` (或其他約定名稱) 的鍵，其值為一個**提示詞物件 (Prompt Object) 的陣列**，每個物件的結構需符合 5. 資料結構中定義的格式。匯入時也應期望讀取此結構。

```json
// 範例 export.json
{
  "prompts": [
    {
      "id": "uuid-123",
      "title": "撰寫部落格文章開頭",
      "purpose": "用於產生引人入勝的部落格文章介紹段落",
      "content": "為一篇關於 [主題] 的部落格文章，寫一個吸引人的開頭段落，包含一個鉤子和對文章內容的簡要預告。",
      "tags": ["#寫作", "#部落格"],
      "createdAt": "2023-10-26T10:00:00Z",
      "updatedAt": "2023-10-27T11:30:00Z",
      "isDeleted": false
    },
    {
      "id": "uuid-456",
      "title": "程式碼註解生成",
      "purpose": "解釋 Python 函數的功能",
      "content": "為以下的 Python 函數撰寫清晰的 docstring 註解，說明其功能、參數和返回值：\n\n```python\n[貼上程式碼]\n```",
      "tags": ["#程式設計", "#Python", "#註解"],
      "createdAt": "2023-10-25T15:20:00Z",
      "updatedAt": "2023-10-25T15:20:00Z",
      "isDeleted": false
    }
    // ... 可能有更多提示詞
  ]
}
```

**7. 錯誤處理與使用者提示**

*   **必要提示：**
    *   複製成功。
    *   插入成功/失敗 (若無法插入)。
    *   儲存成功。
    *   修改成功。
    *   刪除成功 (移至垃圾桶)。
    *   復原成功。
    *   永久刪除成功。
    *   匯出成功/開始下載。
    *   匯入成功/失敗 (含原因，如格式錯誤、讀取失敗)。
*   **確認對話框：** (如 4.1 所述)
    *   確認刪除 (移至垃圾桶)。
    *   確認永久刪除 (單一或多選)。
    *   確認清空垃圾桶。
    *   確認放棄新增。
    *   確認放棄修改。
*   **欄位驗證：** 對必填欄位 (標題、內容) 進行非空驗證，若未填寫，在嘗試儲存/修改時應給予清晰的錯誤提示，並阻止操作。
*   **匯入錯誤：** 處理 JSON 解析錯誤、格式不符等情況，提供使用者易於理解的錯誤訊息。

**8. 非功能性需求**

*   **效能：**
    *   即時搜尋應在可接受的時間內返回結果 (對於數百條提示詞應幾乎無延遲)。
    *   插件啟動和頁籤切換應流暢。
    *   大量資料（數千條提示詞）下的效能應在考慮範圍內，可能需要優化資料讀取和篩選邏輯。
*   **安全性：**
    *   所有使用者資料儲存在本地 `chrome.storage.local`，不應發送到任何外部伺服器。
    *   若使用 Content Script 實現「插入」功能，需謹慎處理權限請求 (`manifest.json`)，僅在必要時請求，並確保不會意外讀取或修改頁面敏感資訊。
*   **易用性：**
    *   介面直觀，操作邏輯清晰。
    *   按鈕和圖示應易於理解。
    *   提供必要的視覺回饋 (如按鈕狀態、成功提示)。